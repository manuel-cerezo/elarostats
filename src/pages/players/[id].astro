---
import Layout from "../../layouts/Layout.astro";
import { getAllPlayers } from "../../api/local";
import { getHeadshotUrl, getTeamLogoUrl } from "../../utils/playerStats";
import { PLAYER_HEADSHOT_FALLBACK_URL } from "../../constants/player";
import PlayerStatsPageWithQuery from "../../components/PlayerStatsPageWithQuery";

export async function getStaticPaths() {
  const players = await getAllPlayers();
  return players.map((player) => ({
    params: { id: String(player.nba_id) },
    props: { player },
  }));
}

const { player } = Astro.props;
const headshotUrl = getHeadshotUrl(player.nba_id);
const teamLogoUrl = getTeamLogoUrl(player.TeamId as number | undefined);
---

<Layout title={`${player.Name} — elarostats`}>
  <main class="mx-auto max-w-2xl px-4 py-10">
    <div class="flex items-center gap-6">
      <img
        src={headshotUrl}
        alt={player.Name}
        class="h-28 w-28 rounded-full border-2 border-gray-200 object-cover dark:border-gray-700"
        onerror={`this.src='${PLAYER_HEADSHOT_FALLBACK_URL}'`}
      />
      <div class="flex flex-1 items-center justify-between gap-4">
        <div>
          <h1 class="text-4xl font-extrabold text-gray-900 dark:text-white">{player.Name}</h1>
          <p class="mt-1 text-gray-500 dark:text-gray-400">
            {player.TeamAbbreviation} · {player.Pos2}
          </p>
          {
            player["Offensive Archetype"] && player["Offensive Archetype"] !== "nan" && (
              <span class="mt-2 inline-block rounded-full bg-orange-500/20 px-3 py-0.5 text-sm font-medium text-orange-500 dark:text-orange-400">
                {player["Offensive Archetype"]}
              </span>
            )
          }
        </div>
        {
          teamLogoUrl && player.TeamId && (
            <a href={`/teams/${player.TeamId}`} title={player.TeamAbbreviation}>
              <img
                src={teamLogoUrl}
                alt={player.TeamAbbreviation}
                class="h-20 w-20 flex-shrink-0 object-contain opacity-90 transition hover:opacity-100"
              />
            </a>
          )
        }
      </div>
    </div>

    <PlayerStatsPageWithQuery client:only="react" player={player} />
  </main>
</Layout>
