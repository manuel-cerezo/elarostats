---
import Layout from "../../layouts/Layout.astro";
import { getAllPlayers } from "../../api/local";
import { getHeadshotUrl, getTeamLogoUrl } from "../../utils/playerStats";
import { PLAYER_HEADSHOT_FALLBACK_URL } from "../../constants/player";
import PlayerPageSearchWithQuery from "../../components/PlayerPageSearchWithQuery";
import PlayerStatsPageWithQuery from "../../components/PlayerStatsPageWithQuery";
import LanguageSelectorWithQuery from "../../components/LanguageSelectorWithQuery";
import ThemeToggleWithQuery from "../../components/ThemeToggleWithQuery";
import TranslatedTextWithQuery from "../../components/TranslatedTextWithQuery";

export async function getStaticPaths() {
  const players = await getAllPlayers();
  return players.map((player) => ({
    params: { id: String(player.nba_id) },
    props: { player },
  }));
}

const { player } = Astro.props;
const headshotUrl = getHeadshotUrl(player.nba_id);
const teamLogoUrl = getTeamLogoUrl(player.TeamId as number | undefined);
---

<Layout title={`${player.Name} — elarostats`}>
  <header class="flex items-center justify-between border-b border-gray-100 px-6 py-4 dark:border-gray-800">
    <a
      href="/"
      class="flex items-center gap-2 text-sm text-gray-500 transition hover:text-gray-900 dark:text-gray-400 dark:hover:text-white"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="16"
        height="16"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="M19 12H5M12 19l-7-7 7-7"></path>
      </svg>
      <TranslatedTextWithQuery client:only="react" k="back" />
    </a>

    <a href="/" class="text-lg font-extrabold tracking-tight">
      elaro<span class="text-orange-500">stats</span>
    </a>

    <div class="flex items-center gap-2">
      <ThemeToggleWithQuery client:only="react" />
      <LanguageSelectorWithQuery client:only="react" />
      <div class="w-48">
        <PlayerPageSearchWithQuery client:only="react" />
      </div>
    </div>
  </header>

  <main class="mx-auto max-w-2xl px-4 py-12">
    <div class="flex items-center gap-6">
      <img
        src={headshotUrl}
        alt={player.Name}
        class="h-28 w-28 rounded-full border-2 border-gray-200 object-cover dark:border-gray-700"
        onerror={`this.src='${PLAYER_HEADSHOT_FALLBACK_URL}'`}
      />
      <div class="flex flex-1 items-center justify-between gap-4">
        <div>
          <h1 class="text-4xl font-extrabold text-gray-900 dark:text-white">{player.Name}</h1>
          <p class="mt-1 text-gray-500 dark:text-gray-400">
            {player.TeamAbbreviation} · {player.Pos2}
          </p>
          {
            player["Offensive Archetype"] && (
              <span class="mt-2 inline-block rounded-full bg-orange-500/20 px-3 py-0.5 text-sm font-medium text-orange-500 dark:text-orange-400">
                {player["Offensive Archetype"]}
              </span>
            )
          }
        </div>
        {
          teamLogoUrl && player.TeamId && (
            <a href={`/teams/${player.TeamId}`} title={player.TeamAbbreviation}>
              <img
                src={teamLogoUrl}
                alt={player.TeamAbbreviation}
                class="h-20 w-20 flex-shrink-0 object-contain opacity-90 transition hover:opacity-100"
              />
            </a>
          )
        }
      </div>
    </div>

    <PlayerStatsPageWithQuery client:only="react" player={player} />
  </main>
</Layout>
